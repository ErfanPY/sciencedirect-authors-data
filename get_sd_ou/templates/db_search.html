{% extends "base.html" %} {% block content %}
<link rel="stylesheet" href="/static/awesomplete.css" />
<script src="/static/awesomplete.js" async></script>
<style>
    .column {
        float: left;
        width: 50%;
    }
    /* Clear floats after the columns */
    
    .row:after {
        content: "";
        display: table;
        clear: both;
    }
</style>
</head>

<body>
    <h1>Database search</h1>
    {% for message in get_flashed_messages() %}
    <p style="color: red;">{{ message }}</p>
    {% endfor %}

    <form id="start_form" method="POST">
        {{ form.hidden_tag() }}
        <p>
            {{ form.date.label }}<br> {{ form.date(class_="form-input") }} {% for error in form.date.errors %}
            <span style="color: red;">[{{ error }}]</span> {% endfor %}
        </p>
        <p>
            <div class="row">
                <div class="column">
                    {{ form.term.label }}<br> {{ form.term(class_="form-input") }}<br> {{ form.pub_title.label }}<br> {{ form.pub_title(class_="form-input") }}<br> {{ form.authors.label }}<br> {{ form.authors(class_="form-input") }}<br> {{ form.affiliation.label
                    }}
                    <br> {{ form.affiliation(class_="form-input") }}<br> {{ form.volume.label }}
                    <br> {{ form.volume(class_="form-input") }}<br> {{ form.issue.label }}<br> {{ form.issue(class_="form-input") }}
                </div>
                <div class="column">
                    {{ form.page.label }}<br> {{ form.page(class_="form-input") }}<br> {{ form.keywords.label }}<br> {{ form.keywords(class_="form-input") }}<br> {{ form.title.label }}<br> {{ form.title(class_="form-input") }}<br> {{ form.refrence.label
                    }}
                    <br> {{ form.refrence(class_="form-input") }}<br> {{ form.docId.label }}<br> {{ form.docId(class_="form-input") }}
                </div>
            </div>
        </p>
        <p>{{ form.submit() }}</p>
    </form>
    <hr>
    <h2>Search results</h2>

    <div id="result"></div>
    <script>
        function update_suggestions(data) {
            Object.entries(data).forEach(([key, value]) => {
                var input = document.getElementById(key);
		if (Array.isArray(value) && value.length){
			console.log(value)
                	aws = new Awesomplete(input, {list: value, maxItems: 3, tabSelect: true, filter:function(text, input){return true;}});
	                aws.open();
		}
                }
            )
        };

        $(document).ready(function() {
            $('#start_form')[0].reset();
            $(".form-input").keyup(function() {
                form = $("#start_form")
                $.ajax({
                    type: 'POST',
                    url: '/db_suggest',
                    data: form.serialize(),
                    success: function(data) {
                        console.log(form.serialize(), data);
                        update_suggestions(data);
                    },
                    error: function() {
                        alert('Unexpected error');
                    }
                });
            });
        });
    </script>
</body>
{% endblock %}
